---
title: "STA 141A- Project 2"
author: "Eshna Prakash"
date: "3/4/2021"
output: html_document
---

```{r setup, include=FALSE}
library(dplyr)
library(ggplot2)
```
# Abstract 

# Introduction
The dataset utilized in this study is from the World Health Organization (WHO) in the format of an excel file that is updated on a daily basis. The data set contains information about COVID-19 cases for each of the 237 countries data was collected from. Data collection began January 3, 2020 and this report uses all data collected until March 1, 2021. The number of new cases, cumulative cases, new deaths and cumulative deaths are recorded for each day of data collection. The hypotheses this report will focus on is that Case Fatality Rate will vary across different countries. 

# Background 
Coronavirus is a highly contagious respiratory illness which is also known as COVID-19. This virus spreads through droplets in the air when an infected person coughs or sneezes. There is no specific treatment for the virus and laboratory tests are required for confirmation of diagnosis. While most recover from COVID-19, some have symptoms that last for weeks or even months after recovering from acute illness. The long term effects of COVID-19 are not currently known and it is being investigated. Those with a higher risk of dying from COVID-19 and related complications are older people and those with underlying medical conditions. Prevention measures that can be taken against this virus include wearing facial coverings, frequent washing of hands and social distancing. Currently, there is an increase in global coronavirus cases which may be due to public health restrictions being lifted in addition to new coronavirus variants.(WHO, 2021). Multiple vaccines have been developed for emergency use and over 245 million doses have been administered in 107 countries.

Case Fatality Rate (CFR) is all deaths from the specific disease in the population divided by all cases of the disease in the population. It is important to note that CFR is not an accurate measure of the mortality risk of the disease during a pandemic.


# Descriptive Analysis 
This report will not analyze every country from the WHO data set. The WHO regions include African Region (AFR), Regions of the Americas (AMR), South East Asian Region (SEAR), European Region (EUR), Eastern Mediterranean Region (EMR) and the Western Pacific Region (WPR). This report chose the two most populated countries for each WHO region. Therefore, this report looks at Nigeria, Ethiopia, US, Brazil, India, Indonesia, Russia, Turkey, Pakistan, Egypt, China and Japan. The time period selected to focus on was  the 100 days after the 100th confirmed case of COVID-19. The purpose for this was to restrict the data set to verify all countries had at least 100 confirmed coronavirus cases to avoid influencing results due to small numbers. (Sorci, Faivre, & Morand, 2020)

Plots for Nigeria are shown below. Plot of new cases shows a somewhat negative linear trend of new cases over time. In the second plot, there seems to be one data point that appears to be an outlier while the daily number of new deths tends to stay below 20. 

```{r echo=FALSE}
#WHO Data Set 
covid <- read.csv("WHO-COVID-19-global-data.csv")
covid = mutate(covid, CFR = Cumulative_deaths/Cumulative_cases)
names(covid) 

#Nigeria
nigeria=filter(covid,(Country=="Nigeria"))
nigeria=nigeria[89:188,]
nigeria=mutate(nigeria,time=seq(1:100))
par(mfrow=c(2,1))
plot(nigeria$time, nigeria$New_cases, main="Plot of New Cases over time for Nigeria", xlab = "Time (in days)", ylab = "New Cases")
#In this plot we see a somewhat negative linear trend of new cases over time.
plot(nigeria$time, nigeria$New_deaths, main="Plot of New Deaths over time for Nigeria",xlab = "Time (in days)", ylab = "New Deaths")
#In this plot there seems to be one data point that appears to be an outlier while the daily number of new deaths tends to stay below 20.
```
 
Plots for Ethiopia are shown below. Plot of new cases does not appear to be linear but has a positive trend. Plot of new deaths appears to have a positive trend of new deaths as time increases. 
```{r echo=FALSE}
#Ethiopia
ethiopia=filter(covid,(Country=="Ethiopia"))
ethiopia=ethiopia[108:207,]
ethiopia=mutate(ethiopia,time=seq(1:100))
par(mfrow=c(2,1))
plot(ethiopia$time, ethiopia$New_cases, main="Plot of New Cases over time for Ethiopia", xlab = "Time (in days)", ylab = "New Cases")
#In this plot we see a positive trend of new cases as time increases.  It does not appear to be linear.
plot(ethiopia$time, ethiopia$New_deaths, main="Plot of New Deaths over time for Ethiopia",xlab = "Time (in days)", ylab = "New Deaths")
#In this plot, it appears to have a positive trend of new deaths as time increases.
```

Plots for USA are shown below. There appears to be a positive trend in new cases as time increases, especially after approximately the 50th day after the 100th positive case. It does not appear to be linear. In the second plot, the number of new deaths appears to have less variability after the first ten days and does not appear that there is a linear relationship present. 
```{r echo=FALSE}
#USA
usa=filter(covid,(Country=="United States of America"))
usa=usa[61:160,]
usa=mutate(usa,time=seq(1:100))
par(mfrow=c(2,1))
plot(usa$time, usa$New_cases, main="Plot of New Cases over time for USA", xlab = "Time (in days)", ylab = "New Cases")
#In this plot, there is a positive trend in new cases as time increases, especially after approximately the 50th day after the 100th positive case. It does not appear to be linear.
plot(usa$time, usa$New_deaths, main="Plot of New Deaths over time for USA",xlab = "Time (in days)", ylab = "New Deaths")
#In this plot, the number of new deaths appears to have less variability after the first 10 days and it does not seem like there is a linear relationship present.
```

Plots for Brazil are shown below. There is a positive trend in new cases as time increases that appears to be somewhat linear. There is more variability in the number of new cases as time progresses. There appears to be no trend or linear relationship between the new death number and time. 
```{r echo=FALSE}
#Brazil
brazil=filter(covid,(Country=="Brazil"))
brazil=brazil[71:170,]
brazil=mutate(brazil,time=seq(1:100))
par(mfrow=c(2,1))
plot(brazil$time, brazil$New_cases, main="Plot of New Cases over time for Brazil", xlab = "Time (in days)", ylab = "New Cases")
#In this plot, there is a positive trend in new cases as time increases that appears to be somewhat linear. There is more variability in the number of new cases as time progresses.
plot(brazil$time, brazil$New_deaths, main="Plot of New Deaths over time for Brazil",xlab = "Time (in days)", ylab = "New Deaths")
#In this plot, there appears to be no trend or linear relationship present between the new death numbers and days.
```

Plots for India are shown below. There is a positive trend that appears to be linear for new cases. There appears to be a positive linear trend with a few possible outliers present for new deaths over time. 
```{r echo=FALSE}
#India
india=filter(covid,(Country=="India"))
india=india[73:172,]
india=mutate(india,time=seq(1:100))
par(mfrow=c(2,1))
plot(india$time, india$New_cases, main="Plot of New Cases over time for India", xlab = "Time (in days)", ylab = "New Cases")
#In this plot, there is a positive trend. It visually appears to be linear.
plot(india$time, india$New_deaths, main="Plot of New Deaths over time for India",xlab = "Time (in days)", ylab = "New Deaths")
#In this plot, there appears to be a positive linear trend with a few possible outliers present. 
```

Plots for Indonesia are shown below. For new cases over time, it appears that there is a positive linear trend. For new deaths over time, there appears to be a slight positive linear trend with a few possible outliers. 
```{r echo=FALSE}
#Indonesia
indonesia=filter(covid,(Country=="Indonesia"))
indonesia=indonesia[73:172,]
indonesia=mutate(indonesia,time=seq(1:100))
par(mfrow=c(2,1))
plot(indonesia$time, indonesia$New_cases, main="Plot of New Cases over time for Indonesia", xlab = "Time (in days)", ylab = "New Cases")
#In this plot there appears to be a positive linear trend. 
plot(indonesia$time, indonesia$New_deaths, main="Plot of New Deaths over time for Indonesia", xlab = "Time (in days)", ylab = "New Deaths")
#In this plot there appears to be a slight positive linear trend with a few possible outliers. 
```

Plots for Russia are shown below. In the first plot, there appears to be somewhat of a negative linear trend of new cases over time. In the second plot, there does not appear to be an obvious pattern or linear trend. 
```{r echo=FALSE}
#Russia
russia=filter(covid,(Country=="Russian Federation"))
russia=russia[77:176,]
russia=mutate(russia,time=seq(1:100))
par(mfrow=c(2,1))
plot(russia$time, russia$New_cases, main="Plot of New Cases over time for Russia", xlab = "Time (in days)", ylab = "New Cases")
#In this plot we see a somewhat negative linear trend of new cases over time. 
plot(russia$time, russia$New_deaths, main="Plot of New Deaths over time for Russia", xlab = "Time (in days)", ylab = "New Deaths")
#In this plot there is no obvious pattern or linear trend.
```

Plots for Turkey are shown below. There is a clear nonlinear trend of new cases over time with a clear jump around day 70 where cases increase. there is also a clear nonlinear trend for new deaths over time. 
```{r echo=FALSE}
#Turkey
turkey=filter(covid,(Country=="Turkey"))
turkey=turkey[77:176,]
turkey=mutate(turkey,time=seq(1:100))
par(mfrow=c(2,1))
plot(turkey$time, turkey$New_cases, main="Plot of New Cases over time for Turkey", xlab = "Time (in days)", ylab = "New Cases")
#In this plot there is a clear nonlinear trend. There is a clear jump around day 70 where cases increase. 
plot(turkey$time, turkey$New_deaths, main="Plot of New Deaths over time for Turkey", xlab = "Time (in days)", ylab = "New Deaths")
#There is a clear nonlinear trend.
```

Plots for Pakistan are shown below. It is evident that there is no linear trend for both new cases over time and new deaths over time. 
```{r echo=FALSE}
#Pakistan
pakistan=filter(covid,(Country=="Pakistan"))
pakistan=pakistan[75:174,]
pakistan=mutate(pakistan,time=seq(1:100))
par(mfrow=c(2,1))
plot(pakistan$time, pakistan$New_cases, main="Plot of New Cases over time for Pakistan", xlab = "Time (in days)", ylab = "New Cases")
#In this plot, it is evident that there is not a linear trend and is unimodal. 
plot(pakistan$time, pakistan$New_deaths, main="Plot of New Deaths over time for Pakistan", xlab = "Time (in days)", ylab = "New Deaths")
#In this plot, it is evident that there is not a linear trend. 
```

Plots for Egypt are shown below. For both plots, it is evident that there is not a linear trend. 
```{r echo=FALSE}
#Egypt
egypt=filter(covid,(Country=="Egypt"))
egypt=egypt[73:172,]
egypt=mutate(egypt,time=seq(1:100))
par(mfrow=c(2,1))
plot(egypt$time, egypt$New_cases, main="Plot of New Cases over time for Egypt", xlab = "Time (in days)", ylab = "New Cases")
#In this plot, it is evident that there is not a linear trend.
plot(egypt$time, egypt$New_deaths, main="Plot of New Deaths over time for Egypt", xlab = "Time (in days)", ylab = "New Deaths")
#In this plot, it is evident that there is not a linear trend.
```

Plots for China are shown below. There is no clear trend present for new cases over time and it appears that there may be an outlier present. It appears that there is an outlier for new deaths over time as other data points stay below 200 deaths. 
```{r echo=FALSE}
#China 
china=filter(covid,(Country=="China"))
china=china[17:116,]
china=mutate(china,time=seq(1:100))
par(mfrow=c(2,1))
plot(china$time, china$New_cases, main="Plot of New Cases over time for China", xlab = "Time (in days)", ylab = "New Cases")
#In this plot, it appears that there may be an outlier present. There is no clear trend present. 
plot(china$time, china$New_deaths, main="Plot of New Deaths over time for China", xlab = "Time (in days)", ylab = "New Deaths")
#In this plot there is one evident outlier with a constant level of deaths below 200. 
```

Plots for Japan are shown below. There is a clear nonlinear trend of new cases over time. There is a somewhat negative trend with a possible outlier present for new deaths over time. 
```{r echo=FALSE}
#Japan
japan=filter(covid,(Country=="Japan"))
japan=japan[50:149,]
japan=mutate(japan,time=seq(1:100))
par(mfrow=c(2,1))
plot(japan$time, japan$New_cases, main="Plot of New Cases over time for Japan", xlab = "Time (in days)", ylab = "New Cases")
#In this plot, we can see a clear non linear trend of new cases over time. 
plot(japan$time, japan$New_deaths, main="Plot of New Deaths over time for Japan", xlab = "Time (in days)", ylab = "New Deaths")
#In this plot, it appears that there may be an outlier present. There is a somewhat negative trend. 
```

This analysis also wants to look at Case Fatality Rate (CFR) to estimate the proportion of deaths among the identified confirmed cases. It appears that Nigeria, Brazil, and Indonesia have a negative linear trend. USA, Turkey and Japan have a nonlinear trend. Ethiopia, India, Pakistan, Egypt and China do not have a clear trend while Russia has a postive trend. 

```{r echo=FALSE}
#We want to look at CFR in our analysis to estimate the proportion of deaths among identified confirmed cases
#CFR= CFR= all deaths/ all cases 
par(mfrow=c(3,4))
nigeriaCFR= nigeria$Cumulative_deaths/nigeria$Cumulative_cases
plot(nigeriaCFR, main="Plot of Nigeria CFR",xlab = "Time (in days)", ylab = "CFR")
#This plot has a negative linear trend.

ethiopiaCFR= ethiopia$Cumulative_deaths/ethiopia$Cumulative_cases
plot(ethiopiaCFR, main="Plot of Ethiopia CFR",xlab = "Time (in days)", ylab = "CFR")
#This plot has does not have a clear pattern.

usaCFR= usa$Cumulative_deaths/usa$Cumulative_cases
plot(usaCFR, main="Plot of USA CFR",xlab = "Time (in days)", ylab = "CFR")
#This plot had a negative non-linear trend.

brazilCFR= brazil$Cumulative_deaths/brazil$Cumulative_cases
plot(brazilCFR, main="Plot of Brazil CFR",xlab = "Time (in days)", ylab = "CFR")
#This plot has a negative linear trend 

indiaCFR= india$Cumulative_deaths/india$Cumulative_cases
plot(indiaCFR, main="Plot of India CFR",xlab = "Time (in days)", ylab = "CFR")
#This plot does not have a clear trend.

indonesiaCFR= indonesia$Cumulative_deaths/indonesia$Cumulative_cases
plot(indonesiaCFR, main="Plot of Indonesia CFR",xlab = "Time (in days)", ylab = "CFR")
#This plot has a negative linear trend

russiaCFR= russia$Cumulative_deaths/russia$Cumulative_cases
plot(russiaCFR, main="Plot of Russia CFR",xlab = "Time (in days)", ylab = "CFR")
#This plot has a positive trend

turkeyCFR= turkey$Cumulative_deaths/turkey$Cumulative_cases
plot(turkeyCFR, main="Plot of Turkey CFR",xlab = "Time (in days)", ylab = "CFR")
#This plot has a negative non-linear trend

pakistanCFR= pakistan$Cumulative_deaths/pakistan$Cumulative_cases
plot(pakistanCFR, main="Plot of Pakistan CFR",xlab = "Time (in days)", ylab = "CFR")
#This plot does not have a clear trend

egyptCFR= egypt$Cumulative_deaths/egypt$Cumulative_cases
plot(egyptCFR, main="Plot of Egypt CFR",xlab = "Time (in days)", ylab = "CFR")
#This plot does not have a clear trend

chinaCFR= china$Cumulative_deaths/china$Cumulative_cases
plot(chinaCFR, main="Plot of China CFR",xlab = "Time (in days)", ylab = "CFR")
#This plot does not have a clear trend

japanCFR= japan$Cumulative_deaths/japan$Cumulative_cases
plot(japanCFR, main="Plot of Japan CFR",xlab = "Time (in days)", ylab = "CFR")
#This plot has a non-linear trend.
```


# Statistical Approach
##Egypt Model
```{r}
#For Egypt (choose 3, mod 2 only for comparison)
modegypt3=lm(CFR~poly(time,degree=3,raw=T), data = egypt)

plot(egypt$time,egypt$CFR)
lines(smooth.spline(egypt$time,predict(modegypt3)),col='blue')


```
##Japan Model
```{r}
#For Japan
modjapan2=lm(japan$CFR~poly(japan$time,degree=4,raw=T))

plot(japan$time,japan$CFR)
lines(smooth.spline(japan$time,predict(modjapan2)),col='red')

```
##China Model
```{r}
#For China (since the outliers are quite extreme, you guys could make a decision on what to do)

modchina2=lm(china$CFR~poly(china$time,degree=4,raw=T))

plot(china$time,china$CFR)
lines(smooth.spline(china$time,predict(modchina2)),col='red')
```
##Brazil Model
```{r}
#For Brazil 
brazil2= lm(brazil$CFR~poly(brazil$time, degree=2, raw=T))
plot(brazil$time, brazil$CFR)
lines(smooth.spline(brazil$time,predict(brazil2)),col='blue')
```

##India Model
```{r}
#For India 
india2= lm(india$CFR~poly(india$time, degree=4, raw=T))
par(mfrow=c(2,2))
plot(india$time, india$CFR)
lines(smooth.spline(india$time,predict(india2)),col='blue')

```

##Indonesia Model
```{r}
#For Indonesia 
indonesia2= lm(indonesia$CFR~poly(indonesia$time, degree=3, raw=T))
plot(indonesia$time, indonesia$CFR)
lines(smooth.spline(indonesia$time,predict(indonesia2)),col='blue')

```
##Pakistan Model
```{r}
#For Pakistan
pakpoly.model = lm(CFR~ poly(time, degree = 3 , raw = TRUE), data = pakistan)
plot(pakistan$time, pakistan$CFR)
lines(smooth.spline(pakistan$time,predict(pakpoly.model)),col='blue')

```
##Russia Model
```{r}
#For Russia
russpoly.model = lm(CFR~ poly(time, degree = 3, raw = TRUE), data = russia)

plot(russia$time, russia$CFR)
lines(smooth.spline(russia$time,predict(russpoly.model)),col='blue')
```
##Turkey Model
```{r}
#For Turkey
turkpoly.model = lm(CFR~ poly(time, degree = 2, raw = TRUE), data = turkey)
plot(turkey$time, turkey$CFR)
lines(smooth.spline(turkey$time,predict(turkpoly.model)),col='blue')

```
##Nigeria Model
```{r}
#For Nigeria 
nigeria2= lm(nigeria$CFR~poly(nigeria$time, degree=3, raw=TRUE))
plot(nigeria$time, nigeria$CFR)
lines(smooth.spline(nigeria$time,predict(nigeria2)),col='blue')

```
##Ethiopia Model
```{r}
#For Ethiopia 
ethiopia2= lm(ethiopia$CFR~poly(ethiopia$time, degree=3, raw=T))
#stuck between choosing 3 or 4, 3 is more logical of a trend(leaning towards 3), 4 is more fitting and better sensitivity analysis
plot(ethiopia$time, ethiopia$CFR)
lines(smooth.spline(ethiopia$time,predict(ethiopia2)),col='blue')


```
##USA Model
```{r}
#For US
us2= lm(usa$CFR~poly(usa$time, degree=4, raw=T))

plot(usa$time, usa$CFR)
lines(smooth.spline(usa$time,predict(us2)),col='blue')

```


# Results 
```
binddata = rbind(nigeria,ethiopia,usa,brazil,india,indonesia,russia,turkey,pakistan,egypt,china,japan)

fit0 <- lm(CFR ~ poly(time, 3), data = binddata)
fit1 <- lm(CFR ~ poly(time, 3)*Country, data = binddata)

anova(fit0,fit1)

fit3 <- lm(CFR ~ poly(time, 4), data = binddata)
fit4 <- lm(CFR ~ poly(time, 4)*Country, data = binddata)

anova(fit3,fit4)
```
# Sensitivity Analysis 

# Conclusions 

# References 
Sorci, G., Faivre, B., & Morand, S. (2020, November 03). Explaining among-country variation IN COVID-19 case fatality rate. Retrieved March 05, 2021, from https://www.nature.com/articles/s41598-020-75848-2#citeas 
Tadiri, C. P., Gisinger, T., Kautzy-Willer, A., Kublickiene, K., Herrero, M. T., Raparelli, V., Pilote, L., Norris, C. M., & GOING-FWD Consortium (2020). The influence of sex and gender domains on COVID-19 cases and mortality. CMAJ : Canadian Medical Association journal = journal de l'Association medicale canadienne, 192(36), E1041–E1045. https://doi.org/10.1503/cmaj.200971 
World Health Organization. (2021, March 1) WHO press conference on coronavirus disease (COVID-19) [Interview Transcript]. Retrieved from https://www.who.int/multi-media/details/who-press-conference-on-coronavirus-disease-(covid-19)---1-march-2021 
```
```
## R Markdown

```{r}




```


